# 📚 小組功能使用指南

## 🎯 功能概述

小組功能讓讀經夥伴可以組成小組，互相激勵、分享與成長。每個小組最多 6 人，系統會自動隨機分配成員。

---

## 🚀 如何使用

### 1. 加入小組

**指令**：`加入小組`、`👥 加入小組`、`小組`

**功能**：
- 如果沒有未滿的小組，系統會創建新小組
- 如果有未滿的小組，會隨機加入其中一個
- 每個小組最多 6 人

**回應**：
```
🎉 歡迎加入小組！

您已成功加入小組！

💡 小組功能：
• 當組員完成讀經時，會通知其他成員
• 可以在小組留言板互相鼓勵
• 發送「小組資訊」查看成員
• 發送「小組留言」進入留言模式
```

---

### 2. 查看小組資訊

**指令**：`小組資訊`、`👥 小組資訊`、`我的小組`

**功能**：
- 顯示小組 ID
- 列出所有小組成員
- 顯示每位成員的讀經數據

**回應範例**：
```
👥 小組資訊

小組 ID: abc123

成員列表：
1. 張三 ⭐⭐⭐
   總積分: 1250 | 連續: 15天

2. 李四 ⭐⭐
   總積分: 850 | 連續: 8天

3. 王五 ⭐
   總積分: 320 | 連續: 3天
```

---

### 3. 完成讀經自動通知

**觸發時機**：當您完成讀經測驗時

**功能**：
- 自動通知小組其他成員
- 只通知開啟通知的成員
- 記錄到小組訊息歷史

**通知內容**：
```
🎉 小組通知

張三 剛剛完成了今日讀經！

一起為他加油鼓勵吧！💪
```

---

### 4. 小組留言板

#### 4.1 發送留言

**指令**：`小組留言`、`💬 小組留言`、`留言板`

**流程**：
1. 發送指令進入留言模式
2. 輸入您想說的話
3. 系統會發送給所有小組成員
4. 發送「取消」可離開留言模式

**範例**：
```
使用者：小組留言

Bot：📝 已進入小組留言模式

請輸入您想說的話，將會發送給所有小組成員

發送「取消」離開留言模式

---

使用者：今天的經文好感動！

Bot：✅ 留言已發送給 5 位小組成員！
```

#### 4.2 查看留言歷史

**指令**：`留言歷史`、`查看留言`

**功能**：
- 顯示最近 10 則小組訊息
- 包含留言和完成讀經通知
- 顯示發送者和時間

**回應範例**：
```
💬 小組留言板

✅ 張三 (11/07 08:30)
張三 完成了今日讀經

💬 李四 (11/07 09:15)
恭喜張三！我也要加油！

💬 王五 (11/07 10:20)
大家一起努力💪

---
發送「小組留言」繼續互動
```

---

### 5. 換組

**指令**：`換組`、`🔄 換組`、`隨機換組`

**功能**：
- 離開目前的小組
- 隨機加入另一個小組
- 如果沒有其他小組，會創建新小組

**回應**：
```
✅ 換組成功！

您已加入新的小組！

發送「小組資訊」查看新組員
```

---

### 6. 離開小組

**指令**：`離開小組`、`退出小組`

**功能**：
- 完全離開小組
- 不再收到小組通知
- 可隨時重新加入

**回應**：
```
👋 您已離開小組

隨時都可以發送「加入小組」重新加入！
```

---

### 7. 通知設定

#### 7.1 開啟通知

**指令**：`小組通知開啟`、`開啟小組通知`

**功能**：開啟小組成員完成讀經的通知

**回應**：
```
🔔 小組通知已開啟

當組員完成讀經時，您會收到通知！
```

#### 7.2 關閉通知

**指令**：`小組通知關閉`、`關閉小組通知`

**功能**：關閉小組成員完成讀經的通知（但仍會收到留言）

**回應**：
```
🔕 小組通知已關閉

您將不會收到組員完成讀經的通知
```

---

## 💡 使用建議

### 1. 互相鼓勵
- 看到組員完成讀經時，發送鼓勵的留言
- 分享讀經心得和感動
- 為組員代禱

### 2. 定期互動
- 每天至少查看一次小組訊息
- 回應組員的留言
- 分享讀經進度

### 3. 尊重他人
- 留言內容要正面、積極
- 尊重不同的讀經進度
- 避免批評或論斷

---

## 🔧 技術說明

### 資料庫結構

#### Groups Collection
```python
{
  "group_id": "abc123",
  "created_at": "2025-11-07T10:00:00",
  "member_count": 3,
  "members": [
    {
      "user_id": "U123...",
      "display_name": "張三",
      "joined_at": "2025-11-07T10:00:00",
      "notification_enabled": true
    }
  ]
}
```

#### Group Messages Collection
```python
{
  "group_id": "abc123",
  "user_id": "U123...",
  "display_name": "張三",
  "message_type": "text",  # text, reading_completed, prayer_request, encouragement
  "content": "今天的經文好感動！",
  "created_at": "2025-11-07T10:30:00"
}
```

#### User Fields
```python
{
  "group_id": "abc123",  # 所屬小組 ID
  "group_message_state": "IDLE",  # IDLE, WRITING
  "notification_enabled": true  # 是否接收小組通知
}
```

---

## 📊 成本影響

### LINE Push API 使用量

**假設**：
- 100 位使用者
- 50% 加入小組（50 人）
- 平均每組 4 人
- 每天 80% 完成讀經（40 人）

**每日通知量**：
- 完成讀經通知：40 人 × 3 位組員 = 120 次
- 留言通知：假設每天 10 則留言 × 3 位組員 = 30 次
- **總計**：150 次/天

**每月成本**：
- 150 次/天 × 30 天 = 4,500 次
- 扣除免費額度 200 次 = 4,300 次
- 4,300 × $0.003 = **$12.90/月**

**優化建議**：
- 允許使用者關閉通知（已實作）
- 合併通知（如每小時彙整一次）
- 限制留言頻率

---

## 🎯 未來優化方向

1. **小組主題**：允許創建主題小組（如：新約、舊約、特定書卷）
2. **小組挑戰**：設定小組目標，達成後獲得獎勵
3. **小組排行榜**：顯示各小組的總積分排名
4. **小組長功能**：指定小組長管理小組
5. **禱告牆**：專門的禱告請求功能
6. **經文分享**：快速分享經文到小組

---

## ❓ 常見問題

### Q1: 可以選擇加入特定的小組嗎？
A: 目前是隨機分配，未來會考慮加入主題小組功能。

### Q2: 小組滿了怎麼辦？
A: 系統會自動創建新小組或加入其他未滿的小組。

### Q3: 可以邀請朋友加入同一個小組嗎？
A: 目前不支援，但可以透過「換組」功能嘗試加入同一組（機率較低）。

### Q4: 留言會保存多久？
A: 目前沒有時間限制，所有留言都會永久保存。

### Q5: 如何避免收到太多通知？
A: 發送「小組通知關閉」即可關閉完成讀經的通知，但仍會收到留言。

---

## 📞 回饋與建議

如果您對小組功能有任何建議或發現問題，請發送「聯繫作者」與我們聯繫！

🙏 願神的話語透過小組互動，讓我們一起成長！
