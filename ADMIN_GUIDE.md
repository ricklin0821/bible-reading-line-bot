# 管理後台使用指南

## 訪問管理後台

### URL
```
https://YOUR_CLOUD_RUN_URL/admin/
```

### 登入資訊
- **Username:** `admin`
- **Password:** `bible2025`

> ⚠️ **安全提示：** 建議在環境變數中修改預設密碼

---

## 功能說明

### 1. 儀表板（Dashboard）

顯示整體統計資訊：
- 📊 **總使用者數**
- 📈 **平均進度**
- 🔥 **今日活躍使用者**
- ⏱️ **平均完成天數**

以及進度分布圖表。

### 2. 使用者列表（Users）

查看所有使用者的詳細資料，包含：
- 使用者名稱和 LINE ID
- 讀經計畫類型
- 當前天數和進度百分比
- 最後閱讀日期
- **操作按鈕**（新功能）

#### 操作按鈕說明

每個使用者旁邊有兩個操作按鈕：

##### 🔄 測驗按鈕
- **功能：** 重置使用者的測驗狀態
- **影響：** 清除當前的測驗進度，但**保留讀經進度**
- **使用時機：** 當使用者的測驗卡住或出現錯誤時

**操作流程：**
1. 點擊「🔄 測驗」按鈕
2. 確認重置操作
3. 系統自動清除測驗狀態
4. 使用者可以重新開始測驗

##### ⚠️ 進度按鈕
- **功能：** 重置使用者的讀經進度
- **影響：** 清除**所有進度**，回到第 1 天
- **警告：** ⚠️ 此操作**無法復原**！

**操作流程：**
1. 點擊「⚠️ 進度」按鈕
2. 第一次確認
3. 第二次確認（雙重確認機制）
4. 系統重置所有進度
5. 使用者回到第 1 天

#### 其他功能

- **搜尋：** 在搜尋框中輸入使用者名稱或 LINE ID
- **排序：**
  - 📊 依進度排序
  - 📅 依最後閱讀排序
- **查看詳情：** 點擊使用者列（除了按鈕）查看詳細資料

### 3. 統計報表（Statistics）

顯示詳細的統計資料：
- **完成度統計：** 各進度區間的使用者分布
- **活躍度趨勢：** 今日、本週、本月的活躍使用者數

### 4. 資料匯出（Export）

匯出資料為 CSV 格式：
- 📥 **匯出使用者資料**
- 📥 **匯出統計報表**

---

## 常見使用場景

### 場景 1：使用者回報測驗卡住

**問題：** 使用者發送訊息給 Bot 但沒有回應

**解決方法：**
1. 登入管理後台
2. 前往「使用者列表」
3. 找到該使用者（可使用搜尋功能）
4. 點擊「🔄 測驗」按鈕
5. 確認重置
6. 通知使用者重新嘗試

### 場景 2：使用者想重新開始讀經計畫

**問題：** 使用者想從頭開始

**解決方法：**
1. 登入管理後台
2. 前往「使用者列表」
3. 找到該使用者
4. 點擊「⚠️ 進度」按鈕
5. 雙重確認
6. 使用者進度重置到第 1 天

### 場景 3：批量查看使用者狀態

**需求：** 查看哪些使用者最活躍

**操作方法：**
1. 前往「使用者列表」
2. 點擊「📅 依最後閱讀排序」
3. 查看最近活躍的使用者

### 場景 4：匯出資料進行分析

**需求：** 匯出所有使用者資料到 Excel 分析

**操作方法：**
1. 前往「資料匯出」
2. 點擊「📥 匯出使用者資料」
3. 下載 CSV 檔案
4. 使用 Excel 或 Google Sheets 開啟

---

## 技術細節

### API 端點

管理後台使用以下 API 端點：

```
GET  /admin/stats/overview          # 取得總覽統計
GET  /admin/users                   # 取得使用者列表
GET  /admin/users/{user_id}         # 取得使用者詳情
POST /admin/users/{line_user_id}/reset-quiz      # 重置測驗狀態
POST /admin/users/{line_user_id}/reset-progress  # 重置讀經進度
GET  /admin/export/users            # 匯出使用者資料
GET  /admin/export/stats            # 匯出統計報表
```

### 認證方式

使用 HTTP Basic Authentication：
- 所有 API 請求需要在 Header 中包含 `Authorization: Basic <base64(username:password)>`
- 管理頁面會自動處理認證

### 修改預設密碼

在環境變數中設定：
```bash
export ADMIN_USERNAME="your_username"
export ADMIN_PASSWORD="your_password"
```

或在 Cloud Run 部署時設定環境變數。

---

## 疑難排解

### Q: 無法登入管理後台

**可能原因：**
- 帳號密碼錯誤
- 服務未正確部署

**解決方法：**
1. 確認使用正確的帳號密碼（預設：admin / bible2025）
2. 檢查 Cloud Run 服務是否正常運行
3. 查看 Cloud Run 日誌

### Q: 點擊重置按鈕沒有反應

**可能原因：**
- 網路連線問題
- API 端點錯誤

**解決方法：**
1. 檢查瀏覽器控制台（F12）是否有錯誤訊息
2. 確認 Cloud Run 服務正常運行
3. 重新整理頁面後再試

### Q: 重置後使用者狀態沒有改變

**可能原因：**
- 快取問題
- 資料庫同步延遲

**解決方法：**
1. 重新整理頁面
2. 等待幾秒後再查看
3. 查看 Cloud Run 日誌確認操作是否成功

---

## 安全建議

1. ✅ **修改預設密碼**：不要使用預設的 `bible2025`
2. ✅ **限制訪問**：只在信任的網路環境下訪問管理後台
3. ✅ **定期檢查**：定期查看使用者列表，確保沒有異常活動
4. ✅ **謹慎操作**：重置進度前務必確認，避免誤操作

---

## 更新日誌

### v1.1 (2025-10-31)
- ✨ 新增使用者列表中的重置按鈕
- ✨ 新增測驗狀態重置功能
- ✨ 新增讀經進度重置功能
- 🎨 改進使用者列表的操作體驗
- 🔒 加入雙重確認機制防止誤操作

### v1.0 (2025-10-01)
- 🎉 初始版本發布
- 📊 儀表板統計功能
- 👥 使用者列表查看
- 📈 統計報表
- 💾 資料匯出功能

---

**最後更新：** 2025-10-31
